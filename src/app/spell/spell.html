<div class="spell-container">
  <!-- Game Finished Screen -->
  @if (gameFinished) {
  <div class="game-finished">
    <h1>ğŸ‰ æ¸¸æˆç»“æŸ!</h1>
    <div class="score-board">
      <div class="score correct">
        <span class="label">æ­£ç¡®</span>
        <span class="value">{{ correctCount }}</span>
      </div>
      <div class="score wrong">
        <span class="label">é”™è¯¯</span>
        <span class="value">{{ wrongCount }}</span>
      </div>
      <div class="score total">
        <span class="label">æ­£ç¡®ç‡</span>
        <span class="value">{{ words.length > 0 ? ((correctCount / words.length) * 100).toFixed(0) : 0 }}%</span>
      </div>
    </div>
    <button class="btn-restart" (click)="restart()">é‡æ–°å¼€å§‹</button>
  </div>
  }

  <!-- Start Game Screen -->
  @if (!gameStarted && !gameFinished) {
  <div class="game-start">
    <h1>ğŸ”¤ æ‹¼å†™æ¸¸æˆ</h1>
    <p>å¬å•è¯å‘éŸ³ï¼Œæ‹–åŠ¨å­—æ¯æ‹¼å‡ºæ­£ç¡®çš„å•è¯</p>
    <button class="btn-start" (click)="startGame()">å¼€å§‹æ¸¸æˆ</button>
  </div>
  }
  <!-- Game Playing Screen -->
  @if (!gameFinished && gameStarted) {
  <div class="game-playing" cdkDropListGroup>
    <div class="progress-bar">
      <span>è¿›åº¦: {{ progress }}</span>
    </div>

    <div class="card">
      <!-- Current Word Display -->
      <div class="word-display">
        <!-- <h2>{{ currentWord }}</h2> -->
        <button class="audio-btn" (click)="wordAudio.play()">ğŸ”Š</button>
        <audio #wordAudio [src]="'bookcase/power_up_level_0/audio/' + currentWord + '.mp3'" autoplay></audio>
      </div>

      <!-- Letter Slots (Drop Zone) -->
      <div class="letter-slots">
        @for(slot of letterSlots; track slot; let i = $index) {
        <div class="slot" [class.filled]="slot.filled" [class.correct]="showResult && userAnswer[i] === currentWord[i]"
          [class.wrong]="showResult && slot.filled && userAnswer[i] !== currentWord[i]" cdkDropList
          [cdkDropListData]="[slot.letter]" (cdkDropListDropped)="dropToSlot($event, i)" (click)="removeFromSlot(i)">
          {{ slot.letter }}
        </div>
        }
      </div>

      <!-- Scrambled Letters (Drag Source) -->
      <div class="scrambled-letters" cdkDropList [cdkDropListData]="scrambledLetters">
        @for(letter of scrambledLetters; track letter) {
        <div class="letter" cdkDrag>
          {{ letter }}
          <div class="letter-placeholder" *cdkDragPlaceholder></div>
        </div>
        }
      </div>

      <!-- Result Display -->
      @if(showResult) {
      <div class="result">
        @if(isCorrect) {
        <span class="correct-msg">âœ… æ­£ç¡®!</span>
        } @else {
        <span class="wrong-msg">âŒ é”™è¯¯! æ­£ç¡®ç­”æ¡ˆ: {{ currentWord }}</span>
        }
      </div>
      }

      <!-- Action Buttons -->
      <div class="actions">
        @if(showResult) {
        <button class="btn-next" (click)="nextWord()">ä¸‹ä¸€ä¸ª</button>
        } @else {
        <button class="btn-confirm" [disabled]="!allSlotsFilled" (click)="confirm()">ç¡®è®¤</button>
        }
      </div>
    </div>

    <!-- Current Score -->
    <div class="current-score">
      <span class="correct">âœ… {{ correctCount }}</span>
      <span class="wrong">âŒ {{ wrongCount }}</span>
    </div>
  </div>
  }
</div>